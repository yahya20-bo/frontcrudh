<div class="container mt-4">
  <div class="card p-4 shadow-sm">
    <h5 class="mb-4 text-primary">
      <i class="bi bi-plus-circle me-2"></i> Ajouter une entrée divers
    </h5>

    <form [formGroup]="addForm" (ngSubmit)="onSubmit()">
      <div class="row g-3">

        <!-- Champ obligatoire : N° BE -->
        <div class="col-md-2">
          <label class="form-label">N° BE</label>
          <input class="form-control" formControlName="numeroBE"
            [ngClass]="{'is-invalid': addForm.get('numeroBE')?.invalid && addForm.get('numeroBE')?.touched}" />
          <div class="invalid-feedback" *ngIf="addForm.get('numeroBE')?.invalid && addForm.get('numeroBE')?.touched">
            Champ requis
          </div>
        </div>

        <!-- Fournisseur -->
        <div class="col-md-2">
          <label class="form-label">Fournisseur</label>
          <select class="form-select" formControlName="fournisseur">
            <option value="">--</option>
            <option *ngFor="let f of fournisseurs" [value]="f.id">{{ f.nom }}</option>
          </select>
        </div>

        <!-- Client -->
        <div class="col-md-2">
          <label class="form-label">Client</label>
          <select class="form-select" formControlName="client">
            <option value="">--</option>
            <option *ngFor="let c of clients" [value]="c.id">{{ c.nom }}</option>
          </select>
        </div>

        <div class="col-md-2"><label class="form-label">Origine</label><input class="form-control" formControlName="origine" /></div>

        <!-- Champ obligatoire : Date Entrée -->
        <div class="col-md-2">
          <label class="form-label">Date Entrée</label>
          <input type="date" class="form-control" formControlName="date"
            [ngClass]="{'is-invalid': addForm.get('date')?.invalid && addForm.get('date')?.touched}" />
          <div class="invalid-feedback" *ngIf="addForm.get('date')?.invalid && addForm.get('date')?.touched">
            Date requise
          </div>
        </div>

        <div class="col-md-2"><label class="form-label">Responsable</label><input class="form-control" formControlName="responsable" /></div>

        <div class="col-md-2"><label class="form-label">Raison</label>
          <select class="form-select" formControlName="motif">
            <option value="">--</option>
            <option value="1">ACHAT</option>
            <option value="2">DON</option>
            <option value="3">RETOUR</option>
          </select>
        </div>

        <div class="col-md-2"><label class="form-label">SPL</label><input class="form-control" formControlName="spl" /></div>
        <div class="col-md-2"><label class="form-label">Valeur BE</label><input class="form-control" formControlName="valeurBE" /></div>
        <div class="col-md-2"><label class="form-label">État</label><input class="form-control" formControlName="etat" /></div>
        <div class="col-md-2"><label class="form-label">Facture / DAE</label><input class="form-control" formControlName="facture" /></div>

        <div class="col-md-2">
          <label class="form-label">Magasin</label>
          <select class="form-select" formControlName="magasin">
            <option value="">-- Sélectionner --</option>
            <option *ngFor="let m of magasins || []" [value]="m.id">
              {{ m.designation }}
            </option>
          </select>
        </div>

        <div class="col-md-12">
          <label class="form-label">Description</label>
          <textarea rows="2" class="form-control" formControlName="description"></textarea>
        </div>

        <hr class="my-3">

        <!-- Article requis -->
        <div class="col-md-3">
          <label class="form-label">Article</label>
          <select class="form-select" formControlName="articleId"
            [ngClass]="{'is-invalid': addForm.get('articleId')?.invalid && addForm.get('articleId')?.touched}">
            <option value="">-- Sélectionner --</option>
            <option *ngFor="let a of articles" [value]="a.id">{{ a.ref }} - {{ a.designation }}</option>
          </select>
          <div class="invalid-feedback" *ngIf="addForm.get('articleId')?.invalid && addForm.get('articleId')?.touched">
            Article requis
          </div>
        </div>

        <!-- Stock requis -->
        <div class="col-md-3">
          <label class="form-label">Entité de stock</label>
          <select class="form-select" formControlName="stockId"
            [ngClass]="{'is-invalid': addForm.get('stockId')?.invalid && addForm.get('stockId')?.touched}">
            <option value="">-- Sélectionner --</option>
            <option *ngFor="let stock of stocks" [value]="stock.id">
              {{ stock.libelleArticle }} - {{ stock.referenceArticle }}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="addForm.get('stockId')?.invalid && addForm.get('stockId')?.touched">
            Stock requis
          </div>
        </div>

        <!-- Quantité requise -->
        <div class="col-md-2">
          <label class="form-label">Quantité</label>
          <input type="number" class="form-control" formControlName="quantite"
            [ngClass]="{'is-invalid': addForm.get('quantite')?.invalid && addForm.get('quantite')?.touched}" />
          <div class="invalid-feedback" *ngIf="addForm.get('quantite')?.invalid && addForm.get('quantite')?.touched">
            Quantité requise (min 1)
          </div>
        </div>

        <div class="col-md-2"><label class="form-label">Couleur</label><input type="text" class="form-control" formControlName="couleur" /></div>
        <div class="col-md-2"><label class="form-label">Lot</label><input type="text" class="form-control" formControlName="lot" /></div>
        <div class="col-md-2"><label class="form-label">OA</label><input type="text" class="form-control" formControlName="oa" /></div>
        <div class="col-md-2"><label class="form-label">Laize</label><input type="text" class="form-control" formControlName="laize" /></div>
        <div class="col-md-2"><label class="form-label">Qte Yard</label><input type="text" class="form-control" formControlName="qteYard" /></div>

        <!-- Boutons -->
        <div class="col-12 d-flex justify-content-end gap-2 mt-4">
          <button type="submit" class="btn btn-success"><i class="bi bi-check-circle me-1"></i> Valider</button>
          <button type="button" class="btn btn-outline-success" (click)="exportToExcel()"><i class="bi bi-file-earmark-excel me-1"></i> Exporter Excel</button>
          <button type="button" class="btn btn-outline-danger" (click)="exportToPDF()"><i class="bi bi-file-earmark-pdf me-1"></i> Exporter PDF</button>
        </div>
      </div>
    </form>
  </div>
</div>
